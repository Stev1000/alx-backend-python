#!/bin/bash
# Script to perform rolling update for messaging-app

set -e

echo "ğŸ“¦ Applying Blue Deployment update..."
kubectl apply -f blue_deployment.yaml

echo "â³ Monitoring rollout status..."
kubectl rollout status deployment/messaging-app

echo "ğŸŒ Testing for downtime..."
for i in {1..20}
do
  curl -s http://localhost:8000/ > /dev/null
  if [ $? -ne 0 ]; then
    echo "âŒ Request failed at attempt $i â€” downtime detected!"
  else
    echo "âœ… Request succeeded at attempt $i"
  fi
  sleep 2
done

echo "ğŸ” Verifying running pods..."
kubectl get pods -o wide
